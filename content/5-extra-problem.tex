\section{Một số lỗi khác không nằm trong Checklist}

Trong phần này, nhóm trích dẫn một số lỗi tiêu biểu phát hiện được trong quá trình review thư mục \texttt{com/} mà không nằm trong \textit{Java Code Review Checklist}. Mỗi lỗi sẽ bao gồm mô tả, vị trí, mã nguồn hiện tại và đề xuất sửa đổi cụ thể.

\subsection{Lỗi syntax trong khối catch}
\begin{itemize}
    \item \textbf{Tệp tin:} \texttt{/ohs/services/DoctorService.java}
    \item \textbf{Vị trí:} Dòng 86 - 90
    \item \textbf{Mô tả lỗi:} Lỗi cú pháp, dư dấu ngoặc nhọn \texttt{\}} trong khối \texttt{catch}.
\end{itemize}

\textbf{Mã nguồn hiện tại}

\begin{lstlisting}[language=Java]
try {
    // some code
} catch (SQLException ex) { } // extra closing brace
} finally {  
    close(rs, preparedStatement, con);
}
\end{lstlisting}

\textbf{Đề xuất sửa đổi}

\begin{lstlisting}[language=Java]
try {
    // some code
} catch (SQLException ex) { 
    // handle exception
} finally {  
    close(rs, preparedStatement, con);
}
\end{lstlisting}

\subsection{Lỗi type mismatch trong phương thức setStatusId}

\begin{itemize}
    \item \textbf{Tệp tin:} \texttt{/ohs/models/Status.java}
    \item \textbf{Vị trí:} Dòng 24 - 25
    \item \textbf{Mô tả lỗi:} Lỗi biên dịch, sai kiểu dữ liệu trong phép gán một String cho một biến kiểu int và ngược lại.
\end{itemize}

\textbf{Mã nguồn hiện tại} 

\begin{lstlisting}[language=Java]
public void setStatusId(String statusId) {
    this._status = statusId;
    this.statusId = this._status;
}

\end{lstlisting}

\textbf{Đề xuất sửa đổi} 
\begin{lstlisting}[language=Java]
public void setStatusId(String statusId) {
    this.statusId = statusId;
}
\end{lstlisting}

\subsection{Lỗi so sánh chuỗi bằng toán tử \texttt{!=}}

\begin{itemize}
    \item \textbf{Tệp tin:} \texttt{/ohs/services/DoctorService.java}
    \item \textbf{Vị trí:} Dòng 240 - 241
    \item \textbf{Mô tả lỗi:} Lỗi sai ngữ nghĩa, sử dụng toán tử \texttt{!=} để so sánh chuỗi, dẫn đến kết quả không chính xác. Nên sử dụng phương thức \texttt{.equals()} để so sánh nội dung chuỗi.
\end{itemize}

\textbf{Mã nguồn hiện tại} 

\begin{lstlisting}[language=Java]
if (rs.getString("symptoms") != "") // wrong syntax
    appointment.setSymptoms(rs.getString("symptoms"));
\end{lstlisting}

\textbf{Đề xuất sửa đổi} 
\begin{lstlisting}[language=Java]
if (!rs.getString("symptoms").equals("")) // correct syntax
    appointment.setSymptoms(rs.getString("symptoms"));
\end{lstlisting}


\subsection{Lỗi không đóng tài nguyên đúng cách}

\begin{itemize}
    \item \textbf{Tệp tin:} \texttt{AdminService.java}
    \item \textbf{Vị trí:} Dòng 498
    \item \textbf{Mô tả lỗi:} Tài nguyên \texttt{PreparedStatement} và \texttt{Connection} không được đóng đúng cách trong khối \texttt{finally}, có thể gây rò rỉ tài nguyên (resource leak).
\end{itemize}

\textbf{Mã nguồn hiện tại}

\begin{lstlisting}[language=Java]
finally {
    close(rs, preparedStatement, con);
}
\end{lstlisting}

\textbf{Đề xuất sửa đổi}\\
Đảm bảo kiểm tra null trước khi đóng tài nguyên.
\begin{lstlisting}[language=Java]
finally {
    if (rs != null) rs.close();
    if (preparedStatement != null) preparedStatement.close();
    if (con != null) con.close();
}
\end{lstlisting}


\subsection{Lỗi mã hóa cứng thông tin nhạy cảm}

\begin{itemize}
    \item \textbf{Tệp tin:} \texttt{MailService.java}
    \item \textbf{Vị trí:} Dòng 36 -- 37
    \item \textbf{Mô tả lỗi:} Thông tin nhạy cảm như tên người dùng và mật khẩu được mã hóa cứng trong mã nguồn, gây rủi ro bảo mật nghiêm trọng nếu mã nguồn bị lộ.
\end{itemize}

\textbf{Mã nguồn hiện tại}

\begin{lstlisting}[language=Java]
final String userName = jdbcUtility.getPropertyValue("email");
final String appPassword = jdbcUtility.getPropertyValue("appPassword");
\end{lstlisting}

\textbf{Đề xuất sửa đổi}

\begin{lstlisting}[language=Java]
final String userName = System.getenv("EMAIL_USERNAME");
final String appPassword = System.getenv("EMAIL_APP_PASSWORD");
\end{lstlisting}


% \subsection{Lỗi []}

% \begin{itemize}
%     \item \textbf{Tệp tin:} \texttt{[Tên\_file].java}
%     \item \textbf{Vị trí:} Dòng xx - yy
%     \item \textbf{Mô tả lỗi:} Sử dụng cộng chuỗi trực tiếp trong truy vấn SQL, gây nguy cơ bảo mật nghiêm trọng.
% \end{itemize}

% \textbf{Mã nguồn hiện tại} 

% \begin{lstlisting}[language=Java]
% String sql = "SELECT * FROM users 
%               WHERE id = " + id;
% \end{lstlisting}

% \textbf{Đề xuất sửa đổi} 
% \begin{lstlisting}[language=Java]
% String sql = "SELECT * FROM users 
%               WHERE id = ?";
% PreparedStatement pstmt = 
%     conn.prepareStatement(sql);
% pstmt.setInt(1, id);
% \end{lstlisting}

                
